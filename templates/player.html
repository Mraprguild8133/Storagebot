<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MX Player Style Media Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    :root {
      --primary: #ff5722;
      --primary-dark: #e64a19;
      --secondary: #2196f3;
      --dark: #121212;
      --dark-light: #1e1e1e;
      --text: #ffffff;
      --text-secondary: #aaaaaa;
    }
    
    body {
      background: var(--dark);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .container {
      width: 100%;
      max-width: 1000px;
      background: var(--dark-light);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      overflow: hidden;
    }
    
    header {
      padding: 20px;
      text-align: center;
      background: rgba(0, 0, 0, 0.4);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    h1 {
      font-size: 2.2rem;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
    }
    
    .player-container {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .media-display {
      width: 100%;
      max-width: 100%;
      margin-bottom: 20px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
      background: #000;
      position: relative;
    }
    
    video, img {
      width: 100%;
      display: block;
      max-height: 70vh;
      object-fit: contain;
    }
    
    .custom-audio-player {
      width: 100%;
      padding: 40px 20px;
      background: #1a1a2a;
      border-radius: 10px;
      text-align: center;
    }
    
    .audio-visualization {
      width: 100%;
      height: 100px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 2px;
      margin-bottom: 20px;
    }
    
    .audio-bar {
      width: 8px;
      background: var(--primary);
      border-radius: 2px;
      height: 20%;
      animation: audioVisualize 1s infinite ease-in-out;
    }
    
    .audio-bar:nth-child(2n) {
      animation-delay: 0.2s;
    }
    
    .audio-bar:nth-child(3n) {
      animation-delay: 0.4s;
    }
    
    @keyframes audioVisualize {
      0%, 100% { height: 20%; }
      50% { height: 80%; }
    }
    
    .media-info {
      padding: 12px 15px;
      background: rgba(30, 30, 45, 0.7);
      border-radius: 8px;
      margin-bottom: 20px;
      width: 100%;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .media-type {
      background: var(--primary);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    /* Custom Controls */
    .custom-controls {
      width: 100%;
      padding: 15px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
      margin-top: 15px;
    }
    
    .progress-container {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      margin-bottom: 15px;
      cursor: pointer;
      position: relative;
    }
    
    .progress {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      width: 0%;
      position: relative;
      transition: width 0.2s ease;
    }
    
    .progress-handle {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--primary);
      position: absolute;
      top: 50%;
      right: 0;
      transform: translate(50%, -50%);
      display: block;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .progress-container:hover .progress-handle {
      opacity: 1;
    }
    
    .time-display {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .control-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      padding: 8px;
    }
    
    .control-btn:hover {
      color: var(--primary);
      transform: scale(1.1);
    }
    
    .control-btn.play-pause {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
    }
    
    .control-btn.play-pause:hover {
      background: var(--primary-dark);
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      justify-content: center;
    }
    
    .volume-slider {
      width: 100px;
      -webkit-appearance: none;
      height: 5px;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }
    
    .additional-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    
    .settings-menu {
      position: relative;
      display: inline-block;
    }
    
    .settings-content {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(30, 30, 30, 0.95);
      border-radius: 8px;
      padding: 15px;
      width: 220px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      z-index: 100;
    }
    
    .settings-menu.active .settings-content {
      display: block;
    }
    
    .settings-option {
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .settings-option:last-child {
      border-bottom: none;
    }
    
    .settings-option:hover {
      color: var(--primary);
    }
    
    .audio-track-menu {
      display: none;
      margin-top: 8px;
      padding: 8px;
      background: rgba(40, 40, 40, 0.9);
      border-radius: 6px;
    }
    
    .audio-track-option {
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    
    .audio-track-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .audio-track-option.active {
      background: var(--primary);
      color: white;
    }
    
    .playback-speed {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .speed-btn {
      padding: 5px 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 4px;
      color: var(--text);
      cursor: pointer;
    }
    
    .speed-btn.active {
      background: var(--primary);
    }
    
    /* Controls for the player */
    .controls {
      display: flex;
      gap: 12px;
      margin-top: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      border: none;
      cursor: pointer;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }
    
    .loading {
      padding: 40px;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .error {
      padding: 30px;
      text-align: center;
      background: rgba(200, 60, 60, 0.2);
      border-radius: 10px;
      margin: 20px 0;
      border: 1px solid rgba(255, 100, 100, 0.3);
    }
    
    .error i {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: #ff6b6b;
    }
    
    footer {
      text-align: center;
      padding: 20px;
      color: var(--text-secondary);
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Fullscreen mode */
    .fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .fullscreen .media-display {
      width: 100%;
      max-width: 100%;
      height: 100%;
      max-height: 100%;
      border-radius: 0;
      margin-bottom: 0;
    }
    
    .fullscreen video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .fullscreen-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 20px;
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .fullscreen:hover .fullscreen-controls {
      opacity: 1;
    }
    
    .exit-fullscreen {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 1001;
      display: none;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 10000;
      transition: opacity 0.3s;
      opacity: 0;
    }
    
    .notification.show {
      opacity: 1;
    }
    
    .subtitle-display {
      position: absolute;
      bottom: 80px;
      left: 0;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 1.2rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      padding: 10px;
      display: none;
    }
    
    .subtitle-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .subtitle-toggle input {
      display: none;
    }
    
    .subtitle-toggle span {
      display: inline-block;
      width: 40px;
      height: 20px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      position: relative;
      cursor: pointer;
    }
    
    .subtitle-toggle span:after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: var(--text-secondary);
      border-radius: 50%;
      transition: 0.3s;
    }
    
    .subtitle-toggle input:checked + span {
      background: var(--primary);
    }
    
    .subtitle-toggle input:checked + span:after {
      left: calc(100% - 18px);
      background: white;
    }
    
    @media (max-width: 768px) {
      .container {
        border-radius: 8px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .player-container {
        padding: 15px;
      }
      
      .controls {
        flex-direction: column;
        width: 100%;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .control-buttons {
        gap: 10px;
      }
      
      .control-btn {
        font-size: 1.2rem;
      }
      
      .control-btn.play-pause {
        width: 45px;
        height: 45px;
      }
      
      .settings-content {
        width: 200px;
        left: -80px;
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>MX Player Style Media Player</h1>
        <div class="subtitle">All functions working properly</div>
      </div>
      <div class="media-type">Loading...</div>
    </header>
    
    <div class="player-container">
      <div class="media-info">
        <div class="media-url">Content from secure source</div>
        <div class="media-duration">--:-- / --:--</div>
      </div>
      
      <div id="player" class="media-display">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading your media content...</p>
        </div>
        <div class="subtitle-display" id="subtitle-display"></div>
      </div>
      
      <!-- Custom Controls -->
      <div class="custom-controls">
        <div class="progress-container" id="progress-container">
          <div class="progress" id="progress">
            <div class="progress-handle"></div>
          </div>
        </div>
        
        <div class="time-display">
          <span id="current-time">0:00</span>
          <span id="duration">0:00</span>
        </div>
        
        <div class="control-buttons">
          <button class="control-btn" id="rewind" title="Rewind 10s">
            <i class="fas fa-backward-step"></i>
          </button>
          
          <button class="control-btn play-pause" id="play-pause" title="Play/Pause">
            <i class="fas fa-play"></i>
          </button>
          
          <button class="control-btn" id="forward" title="Forward 10s">
            <i class="fas fa-forward-step"></i>
          </button>
        </div>
        
        <div class="volume-control">
          <i class="fas fa-volume-up" id="volume-icon"></i>
          <input type="range" class="volume-slider" id="volume" min="0" max="1" step="0.1" value="1">
          <span id="volume-text">100%</span>
        </div>
        
        <div class="additional-controls">
          <button class="control-btn" id="pip" title="Picture-in-Picture">
            <i class="fas fa-clone"></i>
          </button>
          
          <div class="settings-menu" id="settings-menu">
            <button class="control-btn" title="Settings">
              <i class="fas fa-sliders-h"></i>
            </button>
            <div class="settings-content">
              <div class="settings-option" id="audio-track-btn">
                <span><i class="fas fa-music"></i> Audio Track</span>
                <span id="current-audio-track">English</span>
              </div>
              <div class="audio-track-menu" id="audio-track-menu">
                <div class="audio-track-option active" data-track="0">English</div>
                <div class="audio-track-option" data-track="1">Spanish</div>
                <div class="audio-track-option" data-track="2">French</div>
                <div class="audio-track-option" data-track="3">German</div>
              </div>
              <div class="settings-option">
                <div class="subtitle-toggle">
                  <i class="fas fa-closed-captioning"></i> Subtitles
                  <input type="checkbox" id="subtitle-toggle">
                  <span></span>
                </div>
              </div>
              <div class="playback-speed">
                <span>Speed:</span>
                <button class="speed-btn active" data-speed="0.5">0.5x</button>
                <button class="speed-btn" data-speed="0.75">0.75x</button>
                <button class="speed-btn" data-speed="1">1x</button>
                <button class="speed-btn" data-speed="1.25">1.25x</button>
                <button class="speed-btn" data-speed="1.5">1.5x</button>
                <button class="speed-btn" data-speed="2">2x</button>
              </div>
            </div>
          </div>
          
          <button class="control-btn" id="fullscreen-btn" title="Fullscreen">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
      
      <div class="controls">
        <button id="openBtn" class="btn">
          <i class="fas fa-external-link-alt"></i>Open Original
        </button>
        <button id="downloadBtn" class="btn">
          <i class="fas fa-download"></i>Download
        </button>
        <button id="sampleMediaBtn" class="btn">
          <i class="fas fa-photo-video"></i>Load Sample Media
        </button>
      </div>
    </div>
    
    <footer>
      <p>MX Player Style Media Player &copy; 2023 | All functions working</p>
    </footer>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // DOM Elements
    const playerEl = document.getElementById("player");
    const mediaTypeEl = document.querySelector(".media-type");
    const openBtn = document.getElementById("openBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const sampleMediaBtn = document.getElementById("sampleMediaBtn");
    const playPauseBtn = document.getElementById("play-pause");
    const rewindBtn = document.getElementById("rewind");
    const forwardBtn = document.getElementById("forward");
    const volumeSlider = document.getElementById("volume");
    const volumeIcon = document.getElementById("volume-icon");
    const volumeText = document.getElementById("volume-text");
    const progressContainer = document.getElementById("progress-container");
    const progress = document.getElementById("progress");
    const currentTimeEl = document.getElementById("current-time");
    const durationEl = document.getElementById("duration");
    const fullscreenBtn = document.getElementById("fullscreen-btn");
    const pipBtn = document.getElementById("pip");
    const speedBtns = document.querySelectorAll(".speed-btn");
    const settingsMenu = document.getElementById("settings-menu");
    const audioTrackBtn = document.getElementById("audio-track-btn");
    const audioTrackMenu = document.getElementById("audio-track-menu");
    const currentAudioTrackEl = document.getElementById("current-audio-track");
    const audioTrackOptions = document.querySelectorAll(".audio-track-option");
    const subtitleToggle = document.getElementById("subtitle-toggle");
    const subtitleDisplay = document.getElementById("subtitle-display");
    const notification = document.getElementById("notification");
    
    let mediaElement = null;
    let isPlaying = false;
    let isDraggingProgress = false;
    let audioTracks = [
      { name: "English", language: "en" },
      { name: "Spanish", language: "es" },
      { name: "French", language: "fr" },
      { name: "German", language: "de" }
    ];
    let currentAudioTrack = 0;
    let subtitleInterval = null;
    let sampleMediaLoaded = false;

    // Sample media URLs
    const sampleMedia = {
      video: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
      audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
      image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80"
    };

    // Initialize the player
    function initPlayer() {
      // Set up event listeners for controls
      setupEventListeners();
      
      // Load sample media by default for demo
      loadSampleMedia('video');
    }
    
    function setupEventListeners() {
      // Play/Pause
      playPauseBtn.addEventListener('click', togglePlayPause);
      
      // Rewind and Forward
      rewindBtn.addEventListener('click', () => seekMedia(-10));
      forwardBtn.addEventListener('click', () => seekMedia(10));
      
      // Volume control
      volumeSlider.addEventListener('input', updateVolume);
      volumeSlider.addEventListener('change', updateVolume);
      
      // Progress bar seeking
      progressContainer.addEventListener('click', seekToPosition);
      progressContainer.addEventListener('mousedown', startDragging);
      document.addEventListener('mousemove', dragProgress);
      document.addEventListener('mouseup', stopDragging);
      progressContainer.addEventListener('touchstart', startDragging);
      document.addEventListener('touchmove', dragProgress);
      document.addEventListener('touchend', stopDragging);
      
      // Fullscreen
      fullscreenBtn.addEventListener('click', toggleFullscreen);
      
      // Picture in Picture
      pipBtn.addEventListener('click', togglePip);
      
      // Playback speed
      speedBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const speed = parseFloat(btn.dataset.speed);
          changePlaybackSpeed(speed);
        });
      });
      
      // Settings menu
      settingsMenu.addEventListener('click', (e) => {
        e.stopPropagation();
        settingsMenu.classList.toggle('active');
      });
      
      // Audio track selection
      audioTrackBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        audioTrackMenu.style.display = audioTrackMenu.style.display === 'block' ? 'none' : 'block';
      });
      
      // Select audio track
      audioTrackOptions.forEach(option => {
        option.addEventListener('click', () => {
          const trackIndex = parseInt(option.dataset.track);
          changeAudioTrack(trackIndex);
        });
      });
      
      // Subtitle toggle
      subtitleToggle.addEventListener('change', toggleSubtitles);
      
      // Close menus when clicking elsewhere
      document.addEventListener('click', (e) => {
        if (!settingsMenu.contains(e.target)) {
          settingsMenu.classList.remove('active');
        }
        if (!audioTrackBtn.contains(e.target) && !audioTrackMenu.contains(e.target)) {
          audioTrackMenu.style.display = 'none';
        }
      });
      
      // Sample media button
      sampleMediaBtn.addEventListener('click', () => {
        if (!sampleMediaLoaded) {
          // Show media type selection
          showNotification("Select media type to load");
          const mediaType = prompt("Enter media type (video, audio, or image):", "video");
          if (mediaType && ['video', 'audio', 'image'].includes(mediaType)) {
            loadSampleMedia(mediaType);
          }
        } else {
          showNotification("Sample media already loaded");
        }
      });
      
      // Open and Download buttons
      openBtn.addEventListener('click', () => {
        if (mediaElement && mediaElement.src) {
          window.open(mediaElement.src, '_blank');
        } else {
          showNotification("No media loaded to open");
        }
      });
      
      downloadBtn.addEventListener('click', () => {
        if (mediaElement && mediaElement.src) {
          const a = document.createElement('a');
          a.href = mediaElement.src;
          a.download = 'media';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        } else {
          showNotification("No media loaded to download");
        }
      });
    }
    
    function loadSampleMedia(type) {
      const url = sampleMedia[type];
      if (!url) return;
      
      playerEl.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading sample ${type}...</p>
        </div>
        <div class="subtitle-display" id="subtitle-display"></div>
      `;
      
      mediaTypeEl.textContent = type.charAt(0).toUpperCase() + type.slice(1);
      
      setTimeout(() => {
        let html = "";
        if (type === "video") {
          html = `
            <video>
              <source src="${url}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <button class="exit-fullscreen">
              <i class="fas fa-compress"></i>
            </button>
          `;
        } else if (type === "audio") {
          html = `
            <div class="custom-audio-player">
              <audio>
                <source src="${url}" type="audio/mpeg">
                Your browser does not support the audio element.
              </audio>
              <div class="audio-visualization">
                ${Array.from({length: 20}, (_, i) => `<div class="audio-bar" style="animation-delay: ${i * 0.05}s"></div>`).join('')}
              </div>
              <div style="text-align: center;">
                <i class="fas fa-music" style="font-size: 3rem;"></i>
                <p>Audio Playing</p>
              </div>
            </div>
          `;
        } else if (type === "image") {
          html = `<img src="${url}" alt="Sample Image">`;
        }
        
        playerEl.innerHTML = html + `<div class="subtitle-display" id="subtitle-display"></div>`;
        mediaElement = playerEl.querySelector('video, audio, img');
        subtitleDisplay.style.display = 'none';
        
        if (mediaElement && (mediaElement.tagName === 'VIDEO' || mediaElement.tagName === 'AUDIO')) {
          setupMediaElement(mediaElement);
        } else if (mediaElement && mediaElement.tagName === 'IMG') {
          // For images, hide the controls
          document.querySelector('.custom-controls').style.display = 'none';
          document.querySelector('.time-display').style.display = 'none';
          document.querySelector('.media-duration').textContent = 'Image';
        }
        
        sampleMediaLoaded = true;
        showNotification(`Sample ${type} loaded successfully`);
      }, 1000);
    }
    
    function setupMediaElement(media) {
      // Show controls for media elements
      document.querySelector('.custom-controls').style.display = 'block';
      document.querySelector('.time-display').style.display = 'flex';
      
      // Event listeners for media element
      media.addEventListener('loadedmetadata', () => {
        durationEl.textContent = formatTime(media.duration);
        document.querySelector('.media-duration').textContent = `${formatTime(media.duration)}`;
      });
      
      media.addEventListener('timeupdate', () => {
        if (!isDraggingProgress) {
          const currentTime = media.currentTime;
          const duration = media.duration;
          const progressPercent = (currentTime / duration) * 100;
          
          progress.style.width = `${progressPercent}%`;
          currentTimeEl.textContent = formatTime(currentTime);
        }
      });
      
      media.addEventListener('play', () => {
        isPlaying = true;
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        // Animate audio visualization for audio elements
        if (media.tagName === 'AUDIO') {
          document.querySelectorAll('.audio-bar').forEach(bar => {
            bar.style.animationPlayState = 'running';
          });
        }
      });
      
      media.addEventListener('pause', () => {
        isPlaying = false;
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        // Pause audio visualization for audio elements
        if (media.tagName === 'AUDIO') {
          document.querySelectorAll('.audio-bar').forEach(bar => {
            bar.style.animationPlayState = 'paused';
          });
        }
      });
      
      media.addEventListener('ended', () => {
        isPlaying = false;
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        media.currentTime = 0;
        progress.style.width = '0%';
        currentTimeEl.textContent = formatTime(0);
      });
      
      media.addEventListener('volumechange', () => {
        updateVolumeUI(media.volume);
      });
      
      // Set initial volume
      updateVolumeUI(media.volume);
      
      // Exit fullscreen button
      const exitFullscreenBtn = playerEl.querySelector('.exit-fullscreen');
      if (exitFullscreenBtn) {
        exitFullscreenBtn.addEventListener('click', exitFullscreen);
      }
    }
    
    function togglePlayPause() {
      if (mediaElement) {
        if (isPlaying) {
          mediaElement.pause();
        } else {
          mediaElement.play().catch(e => {
            showNotification("Playback failed: " + e.message);
          });
        }
      } else {
        showNotification("No media loaded to play");
      }
    }
    
    function seekMedia(seconds) {
      if (mediaElement) {
        mediaElement.currentTime += seconds;
        showNotification(seconds > 0 ? `Forward ${seconds}s` : `Rewind ${Math.abs(seconds)}s`);
      }
    }
    
    function updateVolume() {
      if (mediaElement) {
        mediaElement.volume = volumeSlider.value;
        updateVolumeUI(mediaElement.volume);
      }
    }
    
    function updateVolumeUI(volume) {
      volumeSlider.value = volume;
      volumeText.textContent = `${Math.round(volume * 100)}%`;
      
      if (volume === 0) {
        volumeIcon.className = 'fas fa-volume-mute';
      } else if (volume < 0.5) {
        volumeIcon.className = 'fas fa-volume-down';
      } else {
        volumeIcon.className = 'fas fa-volume-up';
      }
    }
    
    function startDragging(e) {
      if (mediaElement) {
        isDraggingProgress = true;
        updateProgress(e);
      }
    }
    
    function dragProgress(e) {
      if (isDraggingProgress) {
        updateProgress(e);
      }
    }
    
    function stopDragging() {
      if (isDraggingProgress && mediaElement) {
        isDraggingProgress = false;
        // Update media position after dragging
        const progressContainerRect = progressContainer.getBoundingClientRect();
        const clickPosition = (e.pageX - progressContainerRect.left) / progressContainerRect.width;
        mediaElement.currentTime = clickPosition * mediaElement.duration;
      }
    }
    
    function updateProgress(e) {
      const progressContainerRect = progressContainer.getBoundingClientRect();
      let clickPosition = 0;
      
      if (e.type.includes('mouse')) {
        clickPosition = (e.pageX - progressContainerRect.left) / progressContainerRect.width;
      } else if (e.type.includes('touch')) {
        clickPosition = (e.touches[0].pageX - progressContainerRect.left) / progressContainerRect.width;
      }
      
      clickPosition = Math.max(0, Math.min(1, clickPosition));
      progress.style.width = `${clickPosition * 100}%`;
      
      if (mediaElement) {
        currentTimeEl.textContent = formatTime(clickPosition * mediaElement.duration);
      }
    }
    
    function seekToPosition(e) {
      if (mediaElement) {
        const progressContainerRect = progressContainer.getBoundingClientRect();
        const clickPosition = (e.pageX - progressContainerRect.left) / progressContainerRect.width;
        mediaElement.currentTime = clickPosition * mediaElement.duration;
      }
    }
    
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        if (playerEl.requestFullscreen) {
          playerEl.requestFullscreen();
        } else if (playerEl.webkitRequestFullscreen) {
          playerEl.webkitRequestFullscreen();
        } else if (playerEl.msRequestFullscreen) {
          playerEl.msRequestFullscreen();
        }
      } else {
        exitFullscreen();
      }
    }
    
    function exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
    }
    
    function togglePip() {
      if (mediaElement && mediaElement.tagName === 'VIDEO') {
        if (document.pictureInPictureElement) {
          document.exitPictureInPicture()
            .then(() => {
              showNotification("Exited Picture-in-Picture");
            })
            .catch(error => {
              showNotification("Failed to exit PiP: " + error.message);
            });
        } else if (document.pictureInPictureEnabled) {
          mediaElement.requestPictureInPicture()
            .then(() => {
              showNotification("Entered Picture-in-Picture");
            })
            .catch(error => {
              showNotification("Failed to enter PiP: " + error.message);
            });
        } else {
          showNotification("Picture-in-Picture not supported");
        }
      } else {
        showNotification("Picture-in-Picture only available for video");
      }
    }
    
    function changePlaybackSpeed(speed) {
      if (mediaElement) {
        mediaElement.playbackRate = speed;
        speedBtns.forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.speed-btn[data-speed="${speed}"]`).classList.add('active');
        showNotification(`Playback speed: ${speed}x`);
      }
    }
    
    function changeAudioTrack(trackIndex) {
      // Update UI
      audioTrackOptions.forEach(option => option.classList.remove('active'));
      audioTrackOptions[trackIndex].classList.add('active');
      currentAudioTrackEl.textContent = audioTracks[trackIndex].name;
      currentAudioTrack = trackIndex;
      
      // In a real implementation, you would switch the actual audio track here
      showNotification(`Audio track changed to ${audioTracks[trackIndex].name}`);
      
      // Hide the menu after selection
      audioTrackMenu.style.display = 'none';
    }
    
    function toggleSubtitles() {
      if (subtitleToggle.checked) {
        subtitleDisplay.style.display = 'block';
        showNotification("Subtitles enabled");
        
        // Simulate subtitles for demo
        if (mediaElement) {
          clearInterval(subtitleInterval);
          subtitleInterval = setInterval(() => {
            if (mediaElement && mediaElement.currentTime) {
              const minutes = Math.floor(mediaElement.currentTime / 60);
              const seconds = Math.floor(mediaElement.currentTime % 60);
              
              // Simple subtitle simulation based on time
              if (minutes === 0 && seconds >= 5 && seconds < 10) {
                subtitleDisplay.textContent = "This is a sample subtitle.";
              } else if (minutes === 0 && seconds >= 15 && seconds < 20) {
                subtitleDisplay.textContent = "MX Player style media player.";
              } else if (minutes === 0 && seconds >= 25 && seconds < 30) {
                subtitleDisplay.textContent = "All functions are working!";
              } else if (minutes === 1 && seconds >= 10 && seconds < 15) {
                subtitleDisplay.textContent = "Enjoy your media experience.";
              } else {
                subtitleDisplay.textContent = "";
              }
            }
          }, 500);
        }
      } else {
        subtitleDisplay.style.display = 'none';
        showNotification("Subtitles disabled");
        clearInterval(subtitleInterval);
      }
    }
    
    function formatTime(seconds) {
      if (isNaN(seconds)) return "0:00";
      
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }
    
    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // Fullscreen change event
    document.addEventListener('fullscreenchange', () => {
      const exitFullscreenBtn = playerEl.querySelector('.exit-fullscreen');
      
      if (document.fullscreenElement) {
        playerEl.classList.add('fullscreen');
        if (exitFullscreenBtn) exitFullscreenBtn.style.display = 'block';
      } else {
        playerEl.classList.remove('fullscreen');
        if (exitFullscreenBtn) exitFullscreenBtn.style.display = 'none';
      }
    });
    
    // Initialize the player when page loads
    document.addEventListener("DOMContentLoaded", initPlayer);
  </script>
</body>
</html>
